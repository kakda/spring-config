<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mobilecnc.companies.service.CompanyDAO">

	<resultMap id="company" type="Company">
		<result property="companyID" column="companyID" />
		<result property="companyName" column="companyName" />
	</resultMap>

	<select id="selectCompanyList" resultMap="company">
		SELECT companyID, companyName FROM Companies
	</select>

	<resultMap id="allCompany" type="Company">
		<result property="companyID" column="companyID" />
		<result property="companyName" column="companyName" />
		<result property="address" column="address" />
		<result property="companyPhone" column="companyPhone" />
		<result property="email" column="email" />
		<result property="description" column="description" />
		<result property="entryDate" column="entryDate" />
		<result property="entryBy" column="entryBy" />
		<result property="lastModifyDate" column="lastModifyDate" />
		<result property="lastModifyBy" column="lastModifyBy" />
	</resultMap>
	
	<select id="insertCompany">
		<![CDATA[
			INSERT INTO Companies 
			(companyID, companyName, address, companyPhone, email, description, entryDate, entryBy, lastModifyDate, lastModifyBy)
			VALUES 
			(#{companyID}, #{companyName}, #{address}, #{companyPhone}, #{email}, #{description}, getDate(), #{entryBy}, getDate(), #{entryBy})
		]]>
	</select>
	
	<select id="updateCompany" parameterType="Company">
		<![CDATA[
			UPDATE Companies
			SET companyName=#{companyName}, 
			address=#{address}, 
			companyPhone=#{companyPhone}, 
			email=#{email}, 
			description=#{description}, 
			lastModifyDate=getDate(), 
			lastModifyBy=#{lastModifyBy}
			WHERE companyID = #{companyID}
		]]>
	</select>
	
	<select id="deleteCompany" parameterType="String">
		<![CDATA[
			DELETE FROM Companies
			WHERE companyID = #{companyID};
		]]>
	</select>
	
	<select id="getCompany" parameterType="String" resultMap="allCompany">
		<![CDATA[
			SELECT *
			FROM Companies
			WHERE companyID = #{companyID};
		]]>
	</select>
	
	<select id="getPagingRecord" resultMap="allCompany"
		parameterType="com.mobilecnc.helper.PagingCondition">
		SELECT * FROM
		(SELECT ROW_NUMBER() OVER (ORDER BY companyID) RowNr, companyID, companyName, address, companyPhone, email, description, entryDate, entryBy, lastModifyDate, lastModifyBy
		FROM Companies
		<where>
			<if test="col != null">
				${where}
			</if>
		</where>
		) AS VTables
		WHERE RowNr BETWEEN #{start} AND #{end}
		ORDER BY ${sidx} ${sord}
	</select>

	<select id="getRecordCount" resultType="int"
		parameterType="com.mobilecnc.helper.PagingCondition">
		SELECT COUNT(companyID) FROM Companies
		<where>
			<if test="#{col} != null">
				${col} ${oper} ${val}
			</if>
		</where>
	</select>
	
</mapper>