<%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<script type="text/javascript">
	$(document).ready(function() {
		var lastsel;
		var addList = new Array();
		var removeList = new Array();
		var addFormatter = function(cellVal,options,rowObject) {
			if(rowObject.addCode==null) return "";
 			return "<input class='c_checkedbox' selected='' value=" + rowObject.addCode + (cellVal==true?" checked":" ") + " type='checkbox' />"
	    };
	    var viewFormatter = function(cellVal,options,rowObject) {
			if(rowObject.viewCode==null) return "";
 			return "<input class='c_checkedbox' value=" + rowObject.viewCode + (cellVal==true?" checked":" ") + " type='checkbox' />"
	    };
	    var updateFormatter = function(cellVal,options,rowObject) {
			if(rowObject.updateCode==null) return "";
 			return "<input class='c_checkedbox' value=" + rowObject.updateCode + (cellVal==true?" checked":" ") + " type='checkbox' />"
	    };
	    var deleteFormatter = function(cellVal,options,rowObject) {
			if(rowObject.deleteCode==null) return "";
 			return "<input class='c_checkedbox' value=" + rowObject.deleteCode + (cellVal==true?" checked":" ") + " type='checkbox' />"
	    };
	    var entryFormatter = function(cellVal,options,rowObject) {
			if(rowObject.entryCode==null) return "";
 			return "<input class='c_checkedbox' value=" + rowObject.entryCode + (cellVal==true?" checked":" ") + " type='checkbox' />"
	    };
		$("#permissionList").jqGrid(
						{
							url : "<c:url value='/auth/ajaxGrid.html?roleID=ROL01'/>",
							datatype : 'json',
							mtype : 'GET',
							colNames : [ 'Object', 'View',
									'Add','Update','Delete', 'Entry'],
							colModel : [ {
								name : 'entity',
								index : 'entity',
								width : 50,
								sortable : false,
								search: false
							}, 
							{
								name : 'view',
								index : 'view',
								formatter: viewFormatter,
								//editable: true,
								align: "center",
								width : 20, 
								//edittype:"checkbox"
							}, 
							{
								name : 'add',
								index : 'add',
								formatter: addFormatter,
								//editable: true,
								align: "center",
								width : 20, 
								//edittype:"checkbox"
							},
							{
								name : 'update',
								index : 'update',
								formatter: updateFormatter,
								//editable: true,
								align: "center",
								width : 20, 
								//edittype:"checkbox"
							},
							{
								name : 'delete',
								index : 'delete',
								formatter: deleteFormatter,
								//editable: true,
								align: "center",
								width : 20, 
								//edittype:"checkbox"

							}, 
							{
								name : 'entry',
								index : 'entry',
								formatter: entryFormatter,
								//editable: true,
								align: "center",
								width : 20, 
								//edittype:"checkbox"
							}],
							postData : {},
							rowNum : 9999,
							rowList : [ 10, 20, 40, 60, 100 ],
							height : 200,
							autowidth : true,
							editable: true,
							editurl:'clientArray',
							rownumbers : true,
							pager : '#permissionPage',
							sortname : 'teamID',
							viewrecords : true,
							sortorder : "asc",
							select: false,
							hoverrows:false,
							caption : "",
							emptyrecords : "Empty records",
							loadonce : false,
							height: 400,
							loadComplete : function() {
								var $this = $(this), ids = $this.jqGrid('getDataIDs'), i, l = ids.length;
							    for (i = 0; i < l; i++) {
							        $this.jqGrid('editRow', ids[i], true);
							    } 
							},
							onSelectRow: function(id){
								$("#permissionList").jqGrid('editRow',id,true);

										lastsel=id; 
							},
							beforeSelectRow : function (){
							    return false;
							},
							jsonReader : {
								page : "page",
								total : "total",
								records : "records",
								root : "rows",
								repeatitems : false
							},
							/* afterEditCell: function (id,name,val,iRow,iCol) {
								$("#permissionList").jqGrid('saveRow', id);
						    }, */
							gridComplete : function() {
								$(".c_checkedbox").click(function(){
									var pCode=$(this).attr("value");
									if($(this).is(":checked")){
										if(!removeList.remove(pCode))
											addList.add(pCode);
									}
									else{
										if(!addList.remove(pCode))
											removeList.add(pCode);
									}
										
								});
							}
						});
		$(".check").click(function(e){
			
			e.preventDefault();
			$("#addList").val(addList);
			alert(addList);
		});
		$(".remove").click(function(e){
			e.preventDefault();
			alert(removeList);
			
		});
		$(".btnSave").click(function(e){
			e.preventDefault();
			$("#frmPermission").submit();
		});
		
	});
	function getRowData(){
		var id = jQuery("#permissionList").jqGrid('getGridParam','selrow'); 
		if (id) { 
			
			var ret = jQuery("#permissionList").jqGrid('getRowData',id);
			alert("*****"+id+"*******id="+ret.addCode+" selected="+ret.add+"..."); 
		} 
		else { 
			alert("Please select row");
		}
	}
	
</script>
<div class="adminform">

	<div class="opr">
		<form id="frmPermission" action="<c:url value='/auth/xxx.html'/>">
		<input type="hidden" id="addList" name="addList"/>
					<input type="text" id="removeList" name="removeList"/>
			<fieldset>
				<legend>Permission Lists</legend>
				
					
				<div>
					<table id="permissionList"></table>
					<div>
					<button class="btnSave save">Save</button>
					<input type="button" value="getData" onclick="getRowData();"/>
					<button class="check">Add</button>
					<button class="remove">List</button>
					</div>
				</div>
			</fieldset>
		</form>
	</div>
</div>
<div class="clr"></div>