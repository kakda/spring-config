<%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>

<script type="text/javascript">
function gridReload() {
    var a = $("#fieldName").val();
    var b = $("#fieldValue").val();
    $("#titleList").jqGrid("setGridParam", {
        url: "<c:url value='/titles/ajaxGrid.html'/>",
        page: 1,
        mtype: "GET",
        search: true,
        postData: {
            searchOper: function () {
                return "cn"
            },
            searchField: function () {
                return a
            },
            searchString: function () {
                return b
            }
        }
    }).trigger("reloadGrid")
}
var autoSearch;
$(window).load(function () {
    autoSearch = $("#autoSearch").attr("checked") ? true : false
});
$(document).ready(function () {
	$(".addNew").click(function(event){
		event.preventDefault();
		window.location = "<c:url value='/titles/add.html' />";
	});
    $(".btnDeleteSelected").click(function (a) {
        a.preventDefault();
        deleteSelctedRow("#titleList", "<c:url value='/titles/doDelete/' />", "titleID")
    });
    $("#titleList").jqGrid({
        url: "<c:url value='/titles/ajaxGrid.html'/>",
        datatype: "json",
        mtype: "GET",
        colNames: ["<spring:message code='th.action'/>", "<spring:message code='th.id'/>", "<spring:message code='th.title'/>", "<spring:message code='th.grade'/>"],
        colModel: [{
            name: "act",
            index: "act",
            width: 16,
            sortable: false,
            search: false
        }, {
            name: "titleID",
            index: "titleID",
            width: 16
        }, {
            name: "titleName",
            index: "titleName",
            width: 33
        }, {
            name: "grade",
            index: "grade",
            width: 18
        }],
        postData: {},
        rowNum: 10,
        rowList: [10, 20, 40, 60, 100],
        height: 200,
        autowidth: true,
        rownumbers: true,
        pager: "#titlePage",
        sortname: "titleID",
        viewrecords: true,
        sortorder: "asc",
        caption: "",
        emptyrecords: "Empty records",
        loadonce: false,
        multiselect: true,
        height: 230,
        page : getPageNumber("pageNumber"),
		multiboxonly:true,
        loadComplete: function () {},
        jsonReader: {
            page: "page",
            total: "total",
            records: "records",
            root: "rows",
            repeatitems: false
        },
        gridComplete: function () {
            gridAction("#titleList", "<c:url value='/titles/' />", "titleID", true, true, true);
            setCookie("pageNumber", $('#titleList').getGridParam('page'));
        }
    });
    $("#titleList").jqGrid("navGrid", "#titlePage", {
        edit: false,
        add: false,
        del: false,
        search: true
    }, {}, {}, {}, {
        sopt: ["cn", "eq"],
        closeOnEscape: true,
        multipleSearch: false,
        closeAfterSearch: true,
        position: "center"
    });
    $("#btnSearch").click(function (a) {
        a.preventDefault();
        gridReload()
    });
    $("#fieldValue").keydown(function () {
        if (autoSearch) {
            setTimeout(gridReload, 500)
        }
    });
    $("#fieldName").change(function () {
        if (autoSearch) {
            setTimeout(gridReload, 500)
        }
    });
    $("#autoSearch").change(function () {
        autoSearch = $(this).attr("checked")
    })
})
</script>
<div class="adminform">
	<div class="opr">
		<form action="">
		<div class="title"><spring:message code='lbl.title_management'/></div>
		<fieldset>
			<legend><spring:message code='lbl.filter'/></legend>
			<table class="form" >
				<tr>
					<td class="input">
						<input type="text" class="textfield" id="fieldValue" />
					</td>
					<td>
						<select id="fieldName" class="select-single" style="width: 200px">
							<option value="titleID"><spring:message code='th.title'/> ID</option>
							<option value="titleName" selected="selected"><spring:message code='th.title'/></option>
							<option value="grade">Gra<spring:message code='th.grade'/>de</option>
						</select>
					</td>
					<td>
						<input type="checkbox" id="autoSearch" />
					</td>
					<td>
						<label for="autoSearch"><spring:message code='lbl.auto'/></label>
					</td>
					<td>
						<button id="btnSearch" class="search"><spring:message code='button.search'/></button>
					</td>
				</tr>
			</table> 
		</fieldset>
		</form>
		<form action="">
			<fieldset>
				<legend><spring:message code='lbl.title_list'/></legend>
				<div>
					<table id="titleList"></table>
					<div id="titlePage"></div>
					<div>
						<button class="btnDeleteSelected delete"><spring:message code='button.delete'/></button>
						<button class="addNew add"><spring:message code='button.add'/></button>
					</div>
				</div>
			</fieldset>
		</form>
	</div>
</div>
<div class="clr"></div>