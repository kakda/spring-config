<%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>

<script type="text/javascript">
	var autoSearch;
	$(window).load(function(){
		autoSearch = $("#autoSearch").attr('checked') ? true : false;
	});
	
	$(document).ready(function() {
		
		 $(".btnDeleteSelected").click(function(event){
			event.preventDefault();
		 	deleteSelctedRow("#employeeList", "<c:url value='/employees/doDelete/' />", 'employeeID');
		 });
		 $(".addNew").click(function(event){
			event.preventDefault();
			window.location = "<c:url value='/employees/add.html'/>";
		 });
		 
		$("#employeeList").jqGrid(
						{
							url : "<c:url value='/employees/ajaxGrid.html'/>",
							datatype : 'json',
							mtype : 'GET',
							colNames : [ '<spring:message code="th.action"/>', '<spring:message code="th.id"/>',
									'<spring:message code="th.employee_name"/>', '<spring:message code="th.team"/>' , '<spring:message code="th.title"/>', '<spring:message code="th.role"/>'],
							colModel : [ {
								name : 'act',
								index : 'act',
								width : 25,
								sortable : false,
								search: false
							}, {
								name : 'employeeID',
								index : 'employeeID',
								width : 20
							}, {
								name : 'employeeName',
								index : 'employeeName',
								width : 50
							}, {
								name : 'teamName',
								index : 'teamName',
								width : 50
							}
							, {
								name : 'titleName',
								index : 'titleName',
								width : 50
							}
							, {
								name : 'roleName',
								index : 'roleName',
								width : 50
							}],
							postData : {},
							rowNum : 10,
							rowList : [ 10, 20, 40, 60, 100 ],
							height : 200,
							autowidth : true,
							rownumbers : true,
							pager : '#employeePage',
							sortname : 'employeeID',
							viewrecords : true,
							sortorder : "asc",
							caption : "",
							emptyrecords : "Empty records",
							loadonce : false,
							multiselect : true,
							height: 230,
							
							page : getPageNumber("pageNumber"),
							
							loadComplete : function() {
							},
							jsonReader : {
								page : "page",
								total : "total",
								records : "records",
								root : "rows",
								repeatitems : false
							},
							gridComplete : function() {
					            gridAction("#employeeList", "<c:url value='/employees/' />", "employeeID", true, true, true);
					            
					            setCookie("pageNumber", $('#employeeList').getGridParam('page'));
					            
							}
						});
		
		$("#employeeList").setGridParam({
            page: 2
        });
		
		$("#employeeList").jqGrid('navGrid', '#employeePage', {
			edit : false,
			add : false,
			del : false,
			search : true
		}, {}, {}, {}, { // search
			sopt : [ 'cn', 'eq' ],
			closeOnEscape : true,
			multipleSearch : false,
			closeAfterSearch : true,
			position: "center"
		});
		$("#btnSearch").click(function(event) {
			event.preventDefault();
			gridReload();
		});
		$("#fieldValue").keydown(function() {
			if (autoSearch) {
				setTimeout(gridReload, 500);
			}
		});
		$("#fieldName").change(function() {
			if (autoSearch) {
				setTimeout(gridReload, 500);
			}
		});
		$("#autoSearch").change(function() {
			autoSearch = $(this).attr('checked');
		});
		
	});
	function gridReload() {
		var fieldName = $("#fieldName").val();
		var fieldValue = $("#fieldValue").val();
		
		var projectID = $("#projectID").val();
		var year = $("#year").val();
		var skills = "";
		$("#skillID :selected").each(function(){
			skills += ((skills!="")?",":"") + $(this).val();
		});
		
		$("#employeeList").jqGrid('setGridParam', {
			url : "<c:url value='/employees/ajaxGrid.html'/>",
			page : 1,
			mtype : "GET",
			search : true,
			postData : {
				searchOper : function() {
					return "cn";
				},
				searchField : function() {
					return fieldName;
				},
				searchString : function() {
					return fieldValue;
				}
			}
		}).trigger("reloadGrid");
	}
	
</script>
<div class="adminform">
	<div class="opr">
		
		<form id="frmFilter" action="">
		<div class="title"><spring:message code='lbl.employee_management'/></div>
		<fieldset>
			<legend><spring:message code='lbl.filter'/></legend>
			<table class="form" >
				<tr>
					<td class="input">
						<input type="text" class="textfield" id="fieldValue" />
					</td>
					<td>
						<select id="fieldName" class="select-single" style="width: 200px">
							<option value="employeeID"><spring:message code='lbl.employee'/> ID</option>
							<option value="employeeName" selected="selected"><spring:message code='th.employee_name'/></option>
							<option value="teamName"><spring:message code='th.team'/></option>
							<option value="titleName"><spring:message code='th.title'/></option>
							<option value="roleName"><spring:message code='th.role'/></option>
						</select>
					</td>
					<td>
						<input type="checkbox" id="autoSearch" />
					</td>
					<td>
						<label for="autoSearch"><spring:message code='lbl.auto'/></label>
					</td>
					<td>
						<button id="btnSearch" class="search"><spring:message code='button.search'/></button>
					</td>
				</tr>
			</table> 
		</fieldset>

		</form>
		<form action="">
			<fieldset>
				<legend><spring:message code='lbl.employee_list'/></legend>
				<div>
					<table id="employeeList"></table>
					<div id="employeePage"></div>
					<div>
					<button class="btnDeleteSelected delete"><spring:message code='button.delete'/></button>
					<button class="addNew add"><spring:message code='button.add'/></button>
					</div>
				</div>
			</fieldset>
		</form>
	</div>
</div>
<div class="clr"></div>