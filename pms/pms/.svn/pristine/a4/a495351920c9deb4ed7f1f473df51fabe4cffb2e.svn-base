<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- Chamroeun -->

<mapper namespace="com.mobilecnc.skills.service.SkillDAO">

	<resultMap id="skill" type="Skill">
		<result property="skillID" column="skillID" />
		<result property="skillName" column="skillName" />
		<result property="description" column="description" />
		<result property="entryDate" column="entryDate" />
		<result property="entryBy" column="entryBy" />
		<result property="lastModifyDate" column="lastModifyDate" />
		<result property="lastModifyBy" column="lastModifyBy" />
	</resultMap>

	<select id="getAllSkills" resultMap="skill"> SELECT * FROM Skills;
	</select>

	<insert id="insertSkill">
		<![CDATA[
			INSERT INTO Skills 
			(skillID, skillName, description, entryDate, entryBy, lastModifyDate, lastModifyBy)
			VALUES
			(#{skillID}, #{skillName}, #{description}, getdate(), #{entryBy}, getDate(), #{entryBy});
		]]>
	</insert>

	<update id="updateSkill" parameterType="Skill"> 
		<![CDATA[ 
			UPDATE Skills 
			SET 
				skillName = #{skillName}, 
				description = #{description}, 
				lastModifyDate = getdate(), 
				lastModifyBy = #{lastModifyBy} 
			WHERE skillID = #{skillID};
		]]>
	</update>

	<select id="deleteSkill" parameterType="String">
		<![CDATA[
			DELETE FROM Skills
			WHERE skillID = #{skillID};
		]]>
	</select>

	<select id="getSkill" parameterType="String" resultMap="skill">
	<![CDATA[
		SELECT *
		FROM Skills
		WHERE skillID = #{skillID};
	]]>
	</select>

	<select id="getPagingRecord" resultMap="skill"
		parameterType="com.mobilecnc.helper.PagingCondition">
		
		SELECT * FROM
		(SELECT ROW_NUMBER() OVER (ORDER BY skillID) RowNr, skillID, skillName, description, entryDate, entryBy, lastModifyDate, lastModifyBy
		FROM Skills		
		<where>
			<if test="col != null">
				${where}
			</if>
		</where>
		) AS VTables
		WHERE RowNr BETWEEN #{start} AND #{end}  
		ORDER BY ${sidx} ${sord}
		
		<!-- SELECT skillID, skillName, description, entryDate, entryBy, lastModifyDate, lastModifyBy
		FROM VSkills WHERE RowNr BETWEEN #{start} AND #{end}
		${where} ORDER BY ${sidx} ${sord} -->
	</select>

	<select id="getRecordCount" resultType="int"
		parameterType="com.mobilecnc.helper.PagingCondition">
		SELECT COUNT(skillID) FROM Skills
		<where>
			<if test="#{col} != null">
				${col} ${oper} ${val}
			</if>
		</where>
	</select>

	<!-- 0 is valid -->
	<select id="checkExistName" resultType="int">
		<![CDATA[
			SELECT COUNT(skillName)
			FROM Skills
			WHERE skillID <> #{skillID} AND skillName LIKE #{skillName};
		]]>
	</select>

</mapper>