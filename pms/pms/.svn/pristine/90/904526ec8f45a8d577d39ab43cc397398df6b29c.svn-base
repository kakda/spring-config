<%@ page contentType="text/html; charset=utf-8" pageEncoding="utf-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>
<script src="<c:url value='/js/jquery.validate.js'/>" type="text/javascript"></script>
<script type="text/javascript">
	$(function() {
		$('#member').chosen().change(function(){
			var allOptionSize = $("select#member option[value!='all']").size();
			var selectedOptionSize = $("select#member option:selected").size();
			if($(this).find('option:selected').val() == 'all'){
				$('select#member option').prop('selected', true);
				$("select#member option[value='all']").remove();
				$('select#member').trigger('liszt:updated');
			}else{
				var allSize = $("select#member option[value='all']").length;
				if(allOptionSize != selectedOptionSize){
					if(allSize != 1){
						$("select#member").prepend('<option value="all">All</option>');
						$('select#member').trigger('liszt:updated');
					}
				}else{
					$("select#member option[value='all']").remove();
					$('select#member').trigger('liszt:updated');
				}
					
			}
		});			
		
        $("#frmAdd").validationEngine();
        
     	// Tabs
		$('#tabs').tabs();
	
		$( "#plannedStartDate" ).datepicker({
			changeMonth: true,
			onSelect: function() {
				var minDate = $(this).datepicker('getDate');
				minDate.add(1).days();
				$( "#plannedEndDate" ).datepicker( "option", "minDate", minDate);
			}
		}).unbind('blur');
		$( "#plannedEndDate" ).datepicker({
			changeMonth: true,
			onSelect: function(selectedDate) {
				var maxDate = $(this).datepicker('getDate');
				maxDate.add(-1).days();
				$( "#plannedStartDate" ).datepicker( "option", "maxDate", maxDate);
			}
		}).unbind('blur');
		
		 $('#revenueLicense, #revenueSI, #revenueThirdParty').keyup(function(){
			var revenueLicense = parseFloat($('#revenueLicense').val()), 
				revenueSI = parseFloat($('#revenueSI').val()), 
				revenueThirdParty = parseFloat($('#revenueThirdParty').val());
			$('#revenue').val(revenueLicense + revenueSI + revenueThirdParty);
		}); 
		
		$('#frmAdd').validate();
		
		$('.save').click(function(){
			setTimeout( "jQuery('.tab-confirm').slideDown();",1000 );	
			checkSVN();
		});
		$('.next').click(function(){
			var e = $(this);
			var i = parseInt(e.attr('i'))+1;
			$(document).find('a[href=#tabs-'+i+']').click();
			return false;
		});
		
		$('.cancel').click(function(){
			if(confirm('Are you sure, you want to cancel adding new project?'))
			{	
				document.location.href = "<c:url value='/projects/index.html' />";
				 return false;
			}	
			
		});
		
		function checkPlannedStartDate()
		{
			var v = $.trim($('#plannedStartDate').val());
			if(! v)
			{	
				$('#plannedEndDate').val('');
			}	
		}
		
		$('*').bind('hover blur mouseout', function(){
			checkPlannedStartDate();
			checkSVN();
			
		});
		
		/* $('.ui-tabs-nav').mouseenter(function(){
			$("#frmAdd").validationEngine('validate');
		}) */
		function checkSVN()
		{
			/* var svnformError = $('.svnformError').find('.formErrorContent').text();
			if(svnformError)
			{
				$('#svn').val('');
			} */
		}
		
		$('#svn').blur(function(){
			checkSVN();
		});
		/*
		if('${userRole}' == 'ROL02')
		{
			$('#employeeID').val('${user}');
			$('.ui-tabs-nav').find('a[href=#tabs-1]').hide();
			$('.ui-tabs-nav').find('a[href=#tabs-2]').click();
		}
		*/

	});
	function insert()
	{
		$('*').removeAttr('disabled');
	}
	
	
	
	
</script>
<div class="adminform">
	<div class="opr">
		<div class="message-alert tab-confirm" style="display:none;">
			<div class="message-invalid">
				<img align="absmiddle" alt="" src="/pms/images/icon/error.png"/><spring:message code="lbl.input_all_tab"/>
			</div>	
		</div>
		<div id="tabs">
		<form action="<c:url value='/projects/doAdd.html' />" id='frmAdd' method="post" onsubmit="return insert();">
		<!-- <input type="text" name="plannedAssignDate" id="plannedAssignDate" /> -->
		<fieldset>
			<legend><spring:message code="lbl.add_new_project"/></legend>	
			<ul>
				<li><a href="#tabs-1"><spring:message code="th.pm"/></a></li>
				<li><a href="#tabs-2"><spring:message code="lbl.project_info"/></a></li>
				<li><a href="#tabs-3"><spring:message code="lbl.schedule"/></a></li>
				<li><a href="#tabs-4"><spring:message code="lbl.member"/></a></li>
			</ul>
			<div id="tabs-1">
				<h3 class="PM"><spring:message code="lbl.select_pm"/></h3>
				<table class="form" cellspacing="0" cellpadding="0" >
					<tr>
						<td style="width: 120px;" class="PM">
						    <label for="employeeID"><spring:message code="th.pm" /></label>
						</td>
						<td style="width: 250px;"><spring:message code="lbl.select_a_pm" var="select_a_pm" />
							<!-- <span class="red">*</span><jsp:include page="/employees/selectEmployeeList.html?roleID=ROL02&id=employeeID&placeholder=${select_a_pm}&validate=required&require=require"></jsp:include> -->
							<span class="red">*</span><jsp:include page="/employees/selectEmployeeList.html?id=employeeID&placeholder=${select_a_pm}&validate=required&require=require"></jsp:include>
						</td>
					</tr>
				</table>
				<div style='padding: 15px 0 0;'>
					<button class="next" i='1'><spring:message code="button.next"/></button>
					<button class="cancel"><spring:message code="button.cancel"/></button>
				</div>
			</div>
			<div id="tabs-2">
				<h3><spring:message code="lbl.enter_project_info"/></h3>
				<table class="form" cellspacing="0" cellpadding="0">
					<tr>
						<td>
							<table class="form" cellspacing="0" cellpadding="0" >
								<tr>
									<td style="width: 120px;">
									    <label for="projectName"><spring:message code="th.name"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<span class="red">*</span><input type="text" name="projectName" id="projectName" class="require textfield validate[required, ajax[ajaxCheckProject], maxSize[50]]" />
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="projectTypeID"><spring:message code="th.type"/></label>
									</td>
									<td style="width: 250px;padding-top: 6px;" class='input'>
										<span class="red">*</span><jsp:include page="/project-types/selectProjectTypeList.html"></jsp:include>
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="billable"><spring:message code="lbl.billable"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input type="checkbox" name="billable" id="billable" class="input" />
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="customerID"><spring:message code="th.customer"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<span class="red">*</span><jsp:include page="/customers/selectCustomerList.html"></jsp:include>
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="revenue"><spring:message code="lbl.currency_type"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<jsp:include page="/currency/selectCurrencyList.html"></jsp:include>
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="revenueLicense"><spring:message code="lbl.revenue_license"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input value="0" type="text" name="revenueLicense" id="revenueLicense" class="decimal textfield  validate[custom[number]]" style="" />
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="revenueSI"><spring:message code="lbl.revenue_si"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input value="0" type="text" name="revenueSI" id="revenueSI" class="decimal textfield validate[custom[number]]" style="" />
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="revenueThirdParty"><spring:message code="lbl.third_party_revenue"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input value="0" type="text" name="revenueThirdParty" id="revenueThirdParty" class="decimal textfield validate[custom[number]]" style="" />
									</td>
								</tr>
							</table>
						</td>
						<td valign="top">
							<table class="form" cellspacing="0" cellpadding="0">
								<tr>
									<td style="width: 120px;">
									    <label for="revenue"><spring:message code="lbl.revenue"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input value="0" readonly="readonly" type="text" name="revenue" id="revenue" class="decimal textfield validate[custom[number]]" style="" />
									</td>
								</tr>
								<tr>	
									<td style="width: 120px;">
									    <label for="description"><spring:message code="lbl.description"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<textarea name="description" id="description" class="textarea" style="width: 100%;"></textarea>
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="svn">SVN <spring:message code="th.name"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input type="text" name="svn" id="svn" class="textfield validate[maxSize[50], ajax[ajaxCheckSVN]]" />
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="redmine">Redmine <spring:message code="th.name"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input type="text" name="redmine" id="redmine" class="textfield validate[maxSize[50]]" />
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
				<div style='padding: 15px 0 0;'>
					<button class="next" i='2'><spring:message code="button.next"/></button>
					<button class="cancel"><spring:message code="button.cancel"/></button>
				</div>
			</div>
			<div id="tabs-3">
				<h3><spring:message code="lbl.enter_project_schedule"/></h3>
				<table class="form" cellspacing="0" cellpadding="0">
					<tr>
						
						<td valign="top">
							<table class="form" cellspacing="0" cellpadding="0">
								<tr>
									<td style="width: 120px;">
									    <label for="plannedStartDate"><spring:message code="lbl.plan_start_date"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input type="text" readonly="readonly" name="plannedStartDate" id="plannedStartDate" class="textfield validate[custom[date]] " style="" />
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="plannedEndDate"><spring:message code="lbl.plan_end_date"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input type="text" readonly="readonly" name="plannedEndDate" id="plannedEndDate" class="textfield validate[custom[date]] " style="" />
									</td>
								</tr>
								<tr>
									<td style="width: 120px;">
									    <label for="plannedMM"><spring:message code="lbl.plan_men_month"/></label>
									</td>
									<td style="width: 250px;" class='input'>
										<input value="0" type="text" name="plannedMM" id="plannedMM" class="decimal textfield validate[custom[number]]" />
									</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
				<div style='padding: 15px 0 0;'>
					<button class="next" i='3'><spring:message code="button.next"/></button>
					<button class="cancel"><spring:message code="button.cancel"/></button>
				</div>
			</div>
			<div id="tabs-4">
				<h3><spring:message code="lbl.select_member_contractor"/></h3>
				<table class="form" cellspacing="0" cellpadding="0">
					<tr>
						<td style="width: 100px;">
						    <label for="member"><spring:message code="lbl.member"/></label>
						</td>
						<td style="width: 250px;height: 50px;" class='input'>
							<spring:message code="lbl.select_member" var="select_member"/>
							<!--<jsp:include page="/employees/selectEmployeeList.html?roleID=ROL03&type=employee&id=member&placeholder=${select_member}&multiple=true"></jsp:include> -->
							<jsp:include page="/employees/selectEmployeeList.html?type=employee&id=member&placeholder=${select_member}&multiple=true"></jsp:include> 
						</td>
					</tr>
					<tr>
						<td style="width: 100px;height: 50px;">
						    <label for="contractor"><spring:message code="lbl.contractor"/></label>
						</td>
						<td style="width: 250px;" class='input'>
							<spring:message code="lbl.select_contractor" var="select_contractor"/>
							<!--<jsp:include page="/employees/selectEmployeeList.html?roleID=ROL03&type=contractor&id=contractor&placeholder=${select_contractor}&multiple=true"></jsp:include>-->
							<jsp:include page="/employees/selectEmployeeList.html?type=contractor&id=contractor&placeholder=${select_contractor}&multiple=true"></jsp:include>
						</td>
					</tr>
				</table>
				<div style='padding: 15px 0 0;'>
					<button class="save"><spring:message code="button.save"/></button>
					<button class="cancel"><spring:message code="button.cancel"/></button>
				</div>
			</div>
		</fieldset>	
		</form>	
		</div>
	</div>
</div>
<div class="clr"></div>