<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- Chamroeun -->

<mapper namespace="com.mobilecnc.customers.service.CustomerDAO">

	<resultMap id="customer" type="Customer">
		<result property="customerID" column="customerID" />
		<result property="customerNameEn" column="customerNameEn" />
		<result property="customerNameKr" column="customerNameKr" />
		<result property="industry" column="industry" />
		<result property="address" column="address" />
		<result property="contactName" column="contactName" />
		<result property="contactMobilePhone" column="contactMobilePhone" />
		<result property="contactCompanyPhone" column="contactCompanyPhone" />
		<result property="contactEmail" column="contactEmail" />
		<result property="description" column="description" />
		<result property="entryDate" column="entryDate" />
		<result property="entryBy" column="entryBy" />
		<result property="lastModifyDate" column="lastModifyDate" />
		<result property="lastModifyBy" column="lastModifyBy" />
	</resultMap>

	<resultMap id="customerList" type="Customer">
        <result property="customerID" column="customerID"/>
		<result property="customerNameEn" column="customerNameEn"/>
		<result property="customerNameKr" column="customerNameKr"/>
    </resultMap>
	
	<select id="getAllCustomers" resultMap="customer"> 
		SELECT * FROM Customers;
	</select>

	<insert id="insertCustomer">
		<![CDATA[
			INSERT INTO Customers
			(customerID, customerNameEn, customerNameKr, industry, address, contactName, contactMobilePhone, contactCompanyPhone, contactEmail, description, entryDate, entryBy, lastModifyDate, lastModifyBy)
			VALUES
			(#{customerID}, #{customerNameEn}, #{customerNameKr}, #{industry}, #{address}, #{contactName}, #{contactMobilePhone}, #{contactCompanyPhone}, #{contactEmail}, #{description}, getdate(), #{entryBy}, getDate(), #{entryBy});
		]]>
	</insert>

	<update id="updateCustomer" parameterType="Customer"> 
		<![CDATA[ 
			UPDATE Customers 
			SET 
				customerNameEn = #{customerNameEn},
				customerNameKr = #{customerNameKr},
				industry = #{industry},
				address = #{address},
				contactName = #{contactName},
				contactMobilePhone = #{contactMobilePhone},
				contactCompanyPhone = #{contactCompanyPhone},
				contactEmail = #{contactEmail},
				description = #{description}, 
				lastModifyDate = getdate(), 
				lastModifyBy = #{lastModifyBy} 
			WHERE customerID = #{customerID};
		]]>
	</update>

	<select id="deleteCustomer" parameterType="String">
		<![CDATA[
			DELETE FROM Customers
			WHERE customerID = #{customerID};
		]]>
	</select>

	<select id="getCustomer" parameterType="String" resultMap="customer">
	<![CDATA[
		SELECT *
		FROM Customers
		WHERE customerID = #{customerID};
	]]>
	</select>

	<select id="getPagingRecord" resultMap="customer"
		parameterType="com.mobilecnc.helper.PagingCondition">
		SELECT * FROM
		(SELECT ROW_NUMBER() OVER (ORDER BY customerID) RowNr, customerID, customerNameEn, customerNameKr, industry, address, contactName, contactMobilePhone, contactCompanyPhone, contactEmail, description, entryDate, entryBy, lastModifyDate, lastModifyBy
		FROM Customers 
		<where>
			<if test="col != null">
				${where}
			</if>
		</where>
		) AS VTables
		WHERE RowNr BETWEEN #{start} AND #{end}
		ORDER BY ${sidx} ${sord}
	</select>

	<select id="getRecordCount" resultType="int"
		parameterType="com.mobilecnc.helper.PagingCondition">
		SELECT COUNT(customerID) FROM Customers
		<where>
			<if test="#{col} != null">
				${col} ${oper} ${val}
			</if>
		</where>
	</select>
	
	<select id="selectCustomerList" resultMap="customerList">  
		<![CDATA[	
			SELECT customerID, customerNameEn, customerNameKr
			FROM Customers 
			; 
		]]>
	</select>
</mapper>