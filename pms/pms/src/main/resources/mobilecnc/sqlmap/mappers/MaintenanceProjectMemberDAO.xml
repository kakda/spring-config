<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mobilecnc.maintenanceProjectMembers.service.MaintenanceProjectMemberDAO">
	<resultMap id="maintenanceProjectMember" type="MaintenanceProjectMember">
        <result property="projectID" column="projectID"/>
		<result property="employeeID" column="employeeID"/>
		<result property="maMemberTypeID" column="maMemberTypeID"/>
		<result property="plannedAssignDate" column="plannedAssignDate"/>
		<result property="plannedReleaseDate" column="plannedReleaseDate"/>
    </resultMap>
    
    <resultMap id="members" type="MaintenanceProjectMember">
		<result property="employeeID" column="employeeID"/>
    </resultMap>
    <select id="selectMaintenanceProjectMembers" resultMap="members" resultType="com.mobilecnc.maintenanceProjectMembers.service.MaintenanceProjectMemberVO">  
		<![CDATA[	
			SELECT PM.employeeID
			FROM MaintenanceProjectMembers AS PM
			INNER JOIN Employees AS EMP
			ON PM.employeeID = EMP.employeeID
			WHERE PM.projectID = #{projectID}
			AND PM.maMemberTypeID = 'MMT02'
			AND EMP.type = #{employeeType}
		]]>
	</select>
	
	<select id="selectMaintenanceProjectMemberList" resultMap="maintenanceProjectMember">  
		<![CDATA[	
			SELECT *
			FROM MaintenanceProjectMembers
		]]>
	</select>
	
	<insert id="insertMaintenanceProjectMember" >
		<![CDATA[
			INSERT INTO MaintenanceProjectMembers
			(
				projectID
				,employeeID
				,maMemberTypeID
				,plannedAssignDate
			)
			VALUES
			(
				#{projectID}
				,#{employeeID}
				,#{maMemberTypeID}
				,#{plannedAssignDate}	
			)				
		]]>
	</insert>
	
	<update id="updateMaintenanceProjectMember" >
		<![CDATA[
			UPDATE MaintenanceProjectMembers
			SET employeeID = #{employeeID}
			WHERE projectID = #{projectID}
			AND maMemberTypeID = #{maMemberTypeID}			
		]]>
	</update>
	
	<select id="selectMaintenanceProjectManager" resultType="String"  >
			SELECT TOP 1 employeeID 
			FROM MaintenanceProjectMembers
			WHERE projectID = #{projectID} AND maMemberTypeID = 'MMT01'
	</select>
	
	<delete id="deleteMaintenanceProjectMembers">
		DELETE FROM MaintenanceProjectMembers
		WHERE projectID = #{projectID}
	</delete>
	
</mapper>