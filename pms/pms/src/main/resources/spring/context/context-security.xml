<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:security="http://www.springframework.org/schema/security"
	xmlns:p="http://www.springframework.org/schema/p" 
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	   		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
			http://www.springframework.org/schema/security 
			http://www.springframework.org/schema/security/spring-security-3.0.xsd">
			
	<bean id="springSecurityFilterChain" class="org.springframework.security.web.FilterChainProxy">
        <security:filter-chain-map path-type="ant">
            <security:filter-chain pattern="/css/**" filters="none" />
            <security:filter-chain pattern="/js/**" filters="none" />
            <security:filter-chain pattern="/doc/**" filters="none" />
            <security:filter-chain pattern="/images/**" filters="none" />
            <security:filter-chain pattern="/user/login*" filters="none" />
            <security:filter-chain pattern="/user/loginfailed*" filters="none" />
            <security:filter-chain pattern="/invalids/**" filters="none" />
            <security:filter-chain pattern="/contact**" filters="none" />
            <security:filter-chain pattern="/usermanual**" filters="none" />
			<security:filter-chain pattern="/teams/mail**" filters="none" />
			<security:filter-chain pattern="/reports/download/progress*" filters="none" />
            <security:filter-chain pattern="/reports/download/token*" filters="none" />
            <security:filter-chain pattern="/**"
                filters="
            securityContextPersistenceFilter,
            logoutFilter,
            authenticationProcessingFilter,
            exceptionTranslationFilter,
            filterSecurityInterceptor,
            concurrentSessionFilter" />

        </security:filter-chain-map>
        
    </bean>

    <bean id="securityContextPersistenceFilter"
        class="org.springframework.security.web.context.SecurityContextPersistenceFilter">
    </bean>

    <bean id="exceptionTranslationFilter"
        class="org.springframework.security.web.access.ExceptionTranslationFilter">
        <property name="authenticationEntryPoint" ref="authenticationEntryPoint" />
        <property name="accessDeniedHandler" ref="accessDeniedHandler" />
    </bean>

    <bean id="authenticationEntryPoint"
        class="org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint">
        <property name="loginFormUrl" value="/user/login.html" />
    </bean>

    <bean id="accessDeniedHandler"
        class="org.springframework.security.web.access.AccessDeniedHandlerImpl">
        <property name="errorPage" value="/user/auth/denied.html" />
    </bean>

    <bean id="authenticationProcessingFilter"
        class="org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter">
        <property name="authenticationManager" ref="customAuthenticationManager" />
        <property name="authenticationFailureHandler" ref="customAuthenticationFailureHandler"/>
        <property name="authenticationSuccessHandler" ref="customAuthenticationSuccessHandler"/>
        <property name="filterProcessesUrl" value="/user/j_spring_security_check"/>
        <property name="sessionAuthenticationStrategy" ref="sessionAuthenticationStrategy"></property>     
    </bean>

    <bean id="filterSecurityInterceptor"
        class="org.springframework.security.web.access.intercept.FilterSecurityInterceptor">
        <property name="authenticationManager" ref="customAuthenticationManager" />
        <property name="accessDecisionManager" ref="accessDecisionManager" />
        <property name="securityMetadataSource" ref="myFilterInvocationSecurityMetadataSource" />
    </bean>

    <bean id="myFilterInvocationSecurityMetadataSource" class="com.mobilecnc.security.service.CustomFilterSecurityMetadataSource">
    </bean>

    <bean id="logoutFilter"
        class="org.springframework.security.web.authentication.logout.LogoutFilter">
        <constructor-arg value="/user/login.html" />
        <constructor-arg ref="logoutHandler">
        </constructor-arg>
        <property name="filterProcessesUrl" value="/user/logout.html" />
    </bean>

    <bean id="logoutHandler"
        class="org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler"></bean>
        
	<bean id="accessDecisionManager" class="org.springframework.security.access.vote.AffirmativeBased">
		<property name="decisionVoters">
			<set>
				<bean class="org.springframework.security.access.vote.RoleVoter"></bean>
			</set>
		</property>
	</bean>
			
		
	<bean id="customAuthenticationManager" class="com.mobilecnc.security.service.CustomAuthenticationManager" />
 	

 	<bean id="customAuthenticationFailureHandler" class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler"
 		p:defaultFailureUrl="/user/login-failed.html" />
 		

 	<bean id="customAuthenticationSuccessHandler" class="org.springframework.security.web.authentication.SimpleUrlAuthenticationSuccessHandler"
 		p:defaultTargetUrl="/main.html" />

	<bean id="concurrentSessionFilter"
        class="org.springframework.security.web.session.ConcurrentSessionFilter">
        <property name="sessionRegistry" ref="sessionRegistry" />
        <property name="expiredUrl" value="/user/login.html" />
        
    </bean>
	
	<bean id="sessionAuthenticationStrategy"
        class="org.springframework.security.web.authentication.session.ConcurrentSessionControlStrategy">
        <constructor-arg name="sessionRegistry"
            ref="sessionRegistry" />
        <property name="maximumSessions" value="1" />
    </bean>
	<bean id="sessionRegistry" class="org.springframework.security.core.session.SessionRegistryImpl" />
	
	<security:authentication-manager/>
	
</beans>

